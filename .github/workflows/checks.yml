# https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions
name: Checks
on:
  workflow_dispatch: #  Allows manual builds
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref || github.run_id }}
  cancel-in-progress: true

jobs:
  ruff:
    runs-on: windows-latest
    steps:
      - name: Checkout ${{ github.repository }}/${{ github.ref }}
        uses: actions/checkout@v5
      - uses: astral-sh/ruff-action@v3
  mypy:
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.9", "3.10", "3.11", "3.12", "3.13", "3.14"]
        # Our minimum numpy 1 supported and latest numpy 2
        numpy-version: ["numpy>=2"]
        # To save on workflow runtime, only test old numpy on extreme ends of Python version
        # This should at least ensure support for oldest combination
        # and let us know when newest numpy drops support for any Python version
        include:
          - python-version: "3.9"
            numpy-version: "numpy==1.25.*"
          - python-version: "3.14"
            numpy-version: "numpy==1.26.*" # Fixes distutils removal issue with setuptools
    steps:
      - name: Checkout ${{ github.repository }}/${{ github.ref }}
        uses: actions/checkout@v5
      - uses: astral-sh/setup-uv@v7
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install the project
        run: uv pip install -r pyproject.toml ${{ matrix.numpy-version }} --group=dev --system
      - run: mypy d3dshot/
  Pyright:
    runs-on: windows-latest
    strategy:
      fail-fast: false
      matrix:
        python-version: ["3.9", "3.10", "3.11", "3.12", "3.13", "3.14"]
        # Our minimum numpy 1 supported and latest numpy 2
        numpy-version: ["numpy>=2"]
        # To save on workflow runtime, only test old numpy on extreme ends of Python version
        # This should at least ensure support for oldest combination
        # and let us know when newest numpy drops support for any Python version
        include:
          - python-version: "3.9"
            numpy-version: "numpy==1.25.*"
          - python-version: "3.14"
            numpy-version: "numpy==1.26.*" # Fixes distutils removal issue with setuptools
    steps:
      - name: Checkout ${{ github.repository }}/${{ github.ref }}
        uses: actions/checkout@v5
      - uses: astral-sh/setup-uv@v7
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install the project
        run: uv pip install -r pyproject.toml ${{ matrix.numpy-version }} --group=dev --system
      - name: Analysing the code with Pyright
        uses: jakebailey/pyright-action@v2
        with:
          python-version: ${{ matrix.python-version }}
          version: PATH
          working-directory: d3dshot/
